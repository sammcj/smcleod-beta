<!doctype html><html lang=en-au><head><meta name=viewport content="width=device-width"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=7"><link rel=icon href=../../../favicon.png><link rel="shortcut icon" href=../../../favicon.ico type=image/x-icon><link rel=apple-touch-icon href=../../../apple-touch-icon.png><link rel=icon href=../../../logo.svg type=image/svg+xml><title>Delayed Serial STONITH &ndash;
smcleod.net</title><link href=../../../symbols-nerd-font/symbols-nerd-font.css rel=stylesheet><link href=../../../jetbrains-mono/jetbrains-mono.css rel=stylesheet><link type=text/css rel=stylesheet href=https://smcleod.net/css/styles.66349763506489d57ba916836ca1c45e0ac3f667fe4f2a152cf7619a81ad51a060782c6231e1a885e311c2fd9fdc72e95b340fbd9530152e367d478fe56978c5.css integrity="sha512-ZjSXY1BkidV7qRaDbKHEXgrD9mf+TyoVLPdhmoGtUaBgeCxiMeGoheMRwv2f3HLpWzQPvZUwFS42fUeP5Wl4xQ=="><meta name=author content="Sam McLeod"><meta name=keywords content="hardware,storage,tech"><meta name=description content="n of <a href=&#34;http://www.scl.co.uk/rcd_serial/README.rcd_serial&#34;>John Sutton&amp;rsquo;s</a> rcd_serial cable coupled with our Supermicro reset switch hijacker:</p>
<p>![]({{ site.url }}/img/san/rcd_serial.jpg)</p>
<p>This works with the rcd_serial fence agent <a href=&#34;https://github.com/ClusterLabs/fence-agents/tree/master/agents/rcd_serial&#34;>plugin</a>.</p>"><meta property="og:site_name" content="smcleod.net"><meta property="og:title" content="Delayed Serial STONITH"><meta property="og:type" content="article"><meta property="article:author" content="Sam McLeod"><meta property="article:published_time" content="2015-07-21T00:00:00Z+0000"><meta property="article:tag" content="hardware"><meta property="article:tag" content="storage"><meta property="article:tag" content="tech"><meta property="og:url" content="https://smcleod.net/2015/07/delayed-serial-stonith/"><meta property="og:image" content="https://smcleod.net/2015/07/delayed-serial-stonith//padlock.jpg"><meta property="og:description" content="<p>A modified version of <a href=&#34;http://www.scl.co.uk/rcd_serial/README.rcd_serial&#34;>John Sutton&amp;rsquo;s</a> rcd_serial cable coupled with our Supermicro reset "><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="mcleod.ne"><meta property="twitter:url" content="https://smcleod.net/2015/07/delayed-serial-stonith/"><meta name=twitter:title content="Delayed Serial STONITH"><meta name=twitter:image content="https://smcleod.net/2015/07/delayed-serial-stonith//padlock.jpg"><meta name=twitter:description content="<p>A modified version of <a href=&#34;http://www.scl.co.uk/rcd_serial/README.rcd_serial&#34;>John Sutton&amp;rsquo;s</a> rcd_serial cable coupled with our Supermicro reset "><link rel=manifest href=../../../manifest/index.json></head><body><div id=baseContainer><header><div class=titleAndSearchContainer><div id=titleContainer><a class=unstyledLink href=../../../><img src=../../../logo.svg alt=Logo></a><div class=rightOfLogo><div class=titleAndHamburger><h1><a class=unstyledLink href=../../../>smcleod.net</a></h1></div><div id=wide_nav><nav><ul id=main-nav><li><a href=../../../>Home</a></li><li><a href=../../../posts>Posts</a></li><li><a href=https://smcleod.net/pages/about/>About</a></li><li><a href=https://smcleod.net/pages/links/>Links</a></li><li><a href=../../../tags>Tags</a></li><li><a href=../../../search>Search</a></li></ul></nav></div></div></div><div class=search><input id=searchbar type=text placeholder=Search>
<a class=nerdlink onclick=newSearch()>&#xf002;</a></div><script>function newSearch(){let e=searchbar.value.trim();if(!e)return;location.href=`/search?q=${e}`}searchbar.onkeyup=e=>{e.keyCode==13&&newSearch()}</script></div><div id=links><a rel=noreferrer target=_blank class=nerdlink href=../../../index.xml>&#xf09e;
<span>RSS</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://github.com/sammcj>&#xf09b;
<span>Github</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://twitter.com/s_mcleod>&#xf099;
<span>Twitter</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://linkedin.com/in/sammcj>&#xf0e1;
<span>LinkedIn</span></a></div></header><div id=contentContainer><div id=content><main><article class="card single"><h1>Delayed Serial STONITH</h1><p class=date><span title=Date></span>
2015-07-21</p><figure style=margin:0><img src=https://smcleod.net/2015/07/delayed-serial-stonith//padlock.jpg alt></figure><div><p>A modified version of <a href=http://www.scl.co.uk/rcd_serial/README.rcd_serial>John Sutton&rsquo;s</a> rcd_serial cable coupled with our Supermicro reset switch hijacker:</p><p>![]({{ site.url }}/img/san/rcd_serial.jpg)</p><p>This works with the rcd_serial fence agent <a href=https://github.com/ClusterLabs/fence-agents/tree/master/agents/rcd_serial>plugin</a>.</p><p>Reasons <code>rcd_serial</code> makes for a very good STONITH mechanism:</p><ul><li>It has no dependency on power state.</li><li>It has no dependency on network state.</li><li>It has no dependency on node operational state.</li><li>It has no dependency on external hardware.</li><li>It costs less that $5 + time to build.</li><li>It is incredibly simple and reliable.</li></ul><p>Essentially the most common STONITH agent type in use is probably those that control UPS / PDUs, while this sounds like a good idea in theory there are a number of issues with relying on a UPS / PDU:</p><ul><li>Units that have remote power control over individual outlets are very expensive and if an upgrade is undertaken a rake-wide outage may be required depending on the existing infrastructure.</li><li>Often these units are managed via the network, requiring the network and all that that entails to be functioning as expected. It also may require an additional NIC that may or may not fit into your storage units.</li><li>There are almost always two PDUs / UPSs to manage, until very recently the PDU STONITH agents only supported sending an action to a single unit, while they now support sending them to two units in modern packages there a number of situations that are complex to manage and predict - i.e. what if one unit responds, cuts the power and the other doesn&rsquo;t? Who&rsquo;s in charge? Do we fail over? etc&mldr; that&rsquo;s a LOT of logic for a STONITH action.</li><li>I&rsquo;ve seen several PDUs fail, it&rsquo;s not pretty and often the management interface is the first thing to go.</li></ul><hr><p><strong><em>Note: The following was v1 of the devices design, a post on the update v2/v3 design can be found <a href=https://smcleod.net/tech/2016/07/04/update-rcd-stonith-design.html>here</a></em></strong></p><hr><p><a href=https://www.linkedin.com/pub/adam-coy/5/989/888>Adam Coy&rsquo;s</a> slightly modified version of the circuit that includes an indicator LED and an <a href=https://en.wikipedia.org/wiki/Opto-isolator>optocoupler</a>:</p><p>![]({{ site.url }}/img/san/optoCircuit.jpg)</p><p>Example of where our Supermicro reset hijack connects on the target node:</p><p>![]({{ site.url }}/img/san/reboot_jumper.jpg)</p><p>Image of the rear of a two node cluster with networking and rcd_serial STONITH (v1) connectors attached:</p><p>![]({{ site.url }}/img/san/storage_with_stonith_rear.jpg)</p><hr><h3 id=availability>Availability</h3><p><strong>UPDATE: This has since been added to RHEL/CentOS and the official Clusterlabs resource agents</strong></p><p>At present the rcd_serial STONITH agent is available as part of the <a href=https://packagecloud.io/s_mcleod/pacemaker/packages/el/7/cluster-glue-1.0.12-1.16.1.x86_64.rpm><code>cluster-glue</code></a> package, <code>cluster-glue</code> is not available in RHEL/CentOS but can be obtained from <a href=ftp://rpmfind.net/linux/opensuse/factory/repo/oss/suse/x86_64/cluster-glue-1.0.12-19.2.x86_64.rpm>OpenSUSE&rsquo;s CentOS7 Repo</a> or <a href=https://packagecloud.io/s_mcleod/pacemaker>my own mirror</a>. (Tested with CentOS 7).</p><p>I have an open ticket with <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1240868">RedHat</a> regarding the fact that their pacemaker rpm is built without the <code>--with stonithd</code> flag which allows this to work without with their version of Pacemaker.</p><p>The long term solution is to get <code>rcd_serial</code> migrated to the new Pacemaker agent <a href=https://fedorahosted.org/cluster/wiki/FenceAgentAPI>API</a> (<a href=http://clusterlabs.org/doxygen/pacemaker/2927a0f9f25610c331b6a137c846fec27032c9ea/stonith-ng_8h.html>or is it this one?</a>) system.</p></div></article><hr><p class=articleTagsContainer><span></span>
<strong>Tags:</strong>
<a class=buttonTag href=../../../tags/hardware>#hardware</a>
<a class=buttonTag href=../../../tags/storage>#storage</a>
<a class=buttonTag href=../../../tags/tech>#tech</a></p><div class=relatedArticlesContainer><hr><h2>More posts like this</h2><div class=postlist><article class="card postlistitem"><div><h2><a href=https://smcleod.net/2022/10/making-work-visible-avoid-dms/>Making Work Visible - Avoid DMs</a></h2><p class=date><span title=Date></span>
2022-10-20
|
<span title=Tags></span>
<a href=../../../tags/communication>#communication</a>
<a href=../../../tags/culture>#culture</a>
<a href=../../../tags/tech>#tech</a>
<a href=../../../tags/work>#work</a></p><a class=unstyledLink href=https://smcleod.net/2022/10/making-work-visible-avoid-dms/><img src=https://smcleod.net/2022/10/making-work-visible-avoid-dms//dm-disruption.jpg alt></a><div class=articlePreview><p><h3 id=avoid-sending-dmspms-for-support-and-technical-questions>Avoid sending DMs/PMs for support and technical questions</h3><p>This is a blurb I usually add to the wiki pages of teams I work with, it&rsquo;s a simple reminder that we should avoid sending direct messages (or worse - calling) individuals for support and technical questions.</p><p>Instead, we should use the appropriate channels for the team. This is a simple way to make work visible, share knowledge, reduce context switching, avoid silos and share the support load.</p></p><p><a href=https://smcleod.net/2022/10/making-work-visible-avoid-dms/>Continue reading </a></p></div></div><hr></article><article class="card postlistitem"><div><h2><a href=https://smcleod.net/2021/07/rancilio-silvia-upgrade/>Rancilio Silvia Upgrade</a></h2><p class=date><span title=Date></span>
2021-07-11
|
<span title=Tags></span>
<a href=../../../tags/coffee>#coffee</a>
<a href=../../../tags/hardware>#hardware</a></p><a class=unstyledLink href=https://smcleod.net/2021/07/rancilio-silvia-upgrade/><img src=https://smcleod.net/2021/07/rancilio-silvia-upgrade//assembled_preview.jpeg alt></a><div class=articlePreview><p><p>Weekend upgrades to my Ranchilio Silvia v4 espresso machine.</p><ul><li>Added a digital <a href=https://www.seattlecoffeegear.com/blog/2018/10/01/whats-a-pid/>PID</a> <a href=https://www.jetblackespresso.com.au/shop/p/rancilio-silvia-pid-preinfusion/>kit</a> for improved temperature control</li><li>Replaced the boiler element</li><li>Thermal insulation</li><li>Basic <a href=https://www.cygnett.com/products/smart-wi-fi-plug-with-power-monitoring>&ldquo;smart&rdquo; power control</a> with Siri integration</li><li>Upgrade the standard Ranchilio basket to a <a href=https://www.dukescoffee.com.au/shop/vst-precision-basket-ridged/>VST 18g Ridged</a></li></ul></p><p><a href=https://smcleod.net/2021/07/rancilio-silvia-upgrade/>Continue reading </a></p></div></div><hr></article></div></div></main><footer><hr><div class=footerColumns><ul class=notlist><li><strong>Links</strong></li><li><a target=_blank href=https://github.com/sammcj>Github | @sammcj</a></li><li><a target=_blank href=https://twitter.com/s_mcleod>Twitter | @s_mcleod</a></li><li><a target=_blank href=https://smcleod.net>This Website | smcleod.net</a></li></ul></div><p><small>2022 &copy; Sam McLeod</small></p><p><small></small></p></footer></div></div></div></body></html>