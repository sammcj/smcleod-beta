<!doctype html><html lang=en-au><head><meta name=viewport content="width=device-width"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=7"><link rel=icon href=../../../favicon.png><link rel="shortcut icon" href=../../../favicon.ico type=image/x-icon><link rel=apple-touch-icon href=../../../apple-touch-icon.png><link rel=icon href=../../../logo.svg type=image/svg+xml><title>Online Conversion from SQL_ASCII to UTF8 in PostgreSQL &ndash;
smcleod.net</title><link href=../../../symbols-nerd-font/symbols-nerd-font.css rel=stylesheet><link href=../../../jetbrains-mono/jetbrains-mono.css rel=stylesheet><link type=text/css rel=stylesheet href=https://beta.smcleod.net/css/styles.66349763506489d57ba916836ca1c45e0ac3f667fe4f2a152cf7619a81ad51a060782c6231e1a885e311c2fd9fdc72e95b340fbd9530152e367d478fe56978c5.css integrity="sha512-ZjSXY1BkidV7qRaDbKHEXgrD9mf+TyoVLPdhmoGtUaBgeCxiMeGoheMRwv2f3HLpWzQPvZUwFS42fUeP5Wl4xQ=="><link href=../../../atkinson-hyperlegible/atkinson-hyperlegible.css rel=stylesheet><meta name=author content="Sam McLeod"><meta name=keywords content="data,software,tech"><meta name=description content="e available here: <a href=&#34;https://github.com/sammcj/sql_ascii_to_utf8&#34;>sql_ascii_to_utf8</a></p>
<h2 id=&#34;the-goal&#34;>The Goal</h2>
<p>To be able to take a Postgres Database which is in SQL_ASCII encoding, and import it into a UTF8 encoded database.</p>
<p>Requirements:</p>
<ul>
<li>Python3 (For RHEL/CentOS 7 <code>yum install python34</code>)</li>
<li>python-nagiosplugin <a href=&#34;https://packagecloud.io/app/s_mcleod/centos7/search?q=python-nagiosplugin&#34;>My pre-built RPMs</a> or <code>pip3 install nagiosplugin</code></li>
<li><a href=&#34;https://github.com/kbytesys/pynagsystemd/blob/master/bin/pynagsystemd.py&#34;>PyNagSystemD</a></li>
</ul>
<h2 id=&#34;the-problem&#34;>The Problem</h2>
<p>Postresql will generate errors like this if it encounters any non-UTF8 byte-sequences during a database restore:</p>
<div class=&#34;highlight&#34;><pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;&#34;><code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;><span style=&#34;display:flex;&#34;><span><span style=&#34;color:#6272a4&#34;># pg_dump -Fc test_badchar | pg_restore -d test_badchar_utf8</span>
</span></span><span style=&#34;display:flex;&#34;><span>pg_restore: <span style=&#34;color:#ff79c6&#34;>[</span>archiver <span style=&#34;color:#ff79c6&#34;>(</span>db<span style=&#34;color:#ff79c6&#34;>)]</span> Error <span style=&#34;color:#ff79c6&#34;>while</span> PROCESSING TOC:
</span></span><span style=&#34;display:flex;&#34;><span>pg_restore: <span style=&#34;color:#ff79c6&#34;>[</span>archiver <span style=&#34;color:#ff79c6&#34;>(</span>db<span style=&#34;color:#ff79c6&#34;>)]</span> Error from TOC entry 2839; <span style=&#34;color:#bd93f9&#34;>0</span> <span style=&#34;color:#bd93f9&#34;>26852</span> TABLE DATA table101 postgres
</span></span><span style=&#34;display:flex;&#34;><span>pg_restore: <span style=&#34;color:#ff79c6&#34;>[</span>archiver <span style=&#34;color:#ff79c6&#34;>(</span>db<span style=&#34;color:#ff79c6&#34;>)]</span> COPY failed <span style=&#34;color:#ff79c6&#34;>for</span> table <span style=&#34;color:#f1fa8c&#34;>&amp;#34;table101&amp;#34;</span>: ERROR:  invalid byte sequence <span style=&#34;color:#ff79c6&#34;>for</span> encoding <span style=&#34;color:#f1fa8c&#34;>&amp;#34;UTF8&amp;#34;</span>: 0x91
</span></span><span style=&#34;display:flex;&#34;><span>CONTEXT:  COPY table101, line <span style=&#34;color:#bd93f9&#34;>1</span>
</span></span><span style=&#34;display:flex;&#34;><span>WARNING: errors ignored on restore: <span style=&#34;color:#bd93f9&#34;>1</span>
</span></span></code></pre></div>"><meta property="og:site_name" content="smcleod.net"><meta property="og:title" content="Online Conversion from SQL_ASCII to UTF8 in PostgreSQL"><meta property="og:type" content="article"><meta property="article:author" content="Sam McLeod"><meta property="article:published_time" content="2016-05-23T00:00:00Z+0000"><meta property="article:tag" content="data"><meta property="article:tag" content="software"><meta property="article:tag" content="tech"><meta property="og:url" content="https://beta.smcleod.net/2016/05/online-conversion-from-sql_ascii-to-utf8-in-postgresql/"><meta property="og:image" content="https://beta.smcleod.net/2016/05/online-conversion-from-sql_ascii-to-utf8-in-postgresql//patrick-tomasso-71909.jpg"><meta property="og:description" content="<p>Scripts and source available here: <a href=&#34;https://github.com/sammcj/sql_ascii_to_utf8&#34;>sql_ascii_to_utf8</a></p>
<h2 id=&#34;the-goal&#34;>The Goal</h2>
<p>To be a"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="beta.smcleod.ne"><meta property="twitter:url" content="https://beta.smcleod.net/2016/05/online-conversion-from-sql_ascii-to-utf8-in-postgresql/"><meta name=twitter:title content="Online Conversion from SQL_ASCII to UTF8 in PostgreSQL"><meta name=twitter:image content="https://beta.smcleod.net/2016/05/online-conversion-from-sql_ascii-to-utf8-in-postgresql//patrick-tomasso-71909.jpg"><meta name=twitter:description content="<p>Scripts and source available here: <a href=&#34;https://github.com/sammcj/sql_ascii_to_utf8&#34;>sql_ascii_to_utf8</a></p>
<h2 id=&#34;the-goal&#34;>The Goal</h2>
<p>To be a"><link rel=manifest href=../../../manifest/index.json></head><body><div id=baseContainer><header><div class=titleAndSearchContainer><div id=titleContainer><a class=unstyledLink href=../../../><img src=../../../logo.svg alt=Logo></a><div class=rightOfLogo><div class=titleAndHamburger><h1><a class=unstyledLink href=../../../>smcleod.net</a></h1></div><div id=wide_nav><nav><ul id=main-nav><li><a href=../../../>Home</a></li><li><a href=../../../posts>Posts</a></li><li><a href=https://beta.smcleod.net/pages/about/>About</a></li><li><a href=https://beta.smcleod.net/pages/links/>Links</a></li><li><a href=../../../tags>Tags</a></li></ul></nav></div></div></div><div class=search><input id=searchbar type=text placeholder=Search>
<a class=nerdlink onclick=newSearch()>&#xf002;</a></div><script>function newSearch(){let e=searchbar.value.trim();if(!e)return;location.href=`/search?q=${e}`}searchbar.onkeyup=e=>{e.keyCode==13&&newSearch()}</script></div><div id=links><a rel=noreferrer target=_blank class=nerdlink href=../../../index.xml>&#xf09e;
<span>RSS</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://github.com/sammcj>&#xf09b;
<span>Github</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://twitter.com/s_mcleod>&#xf099;
<span>Twitter</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://linkedin.com/in/sammcj>&#xf0e1;
<span>LinkedIn</span></a></div></header><div id=contentContainer><div id=content><main><article class="card single"><h1>Online Conversion from SQL_ASCII to UTF8 in PostgreSQL</h1><p class=date><span title=Date></span>
2016-05-23</p><figure style=margin:0><img src=https://beta.smcleod.net/2016/05/online-conversion-from-sql_ascii-to-utf8-in-postgresql//patrick-tomasso-71909.jpg alt></figure><div><p>Scripts and source available here: <a href=https://github.com/sammcj/sql_ascii_to_utf8>sql_ascii_to_utf8</a></p><h2 id=the-goal>The Goal</h2><p>To be able to take a Postgres Database which is in SQL_ASCII encoding, and import it into a UTF8 encoded database.</p><p>Requirements:</p><ul><li>Python3 (For RHEL/CentOS 7 <code>yum install python34</code>)</li><li>python-nagiosplugin <a href="https://packagecloud.io/app/s_mcleod/centos7/search?q=python-nagiosplugin">My pre-built RPMs</a> or <code>pip3 install nagiosplugin</code></li><li><a href=https://github.com/kbytesys/pynagsystemd/blob/master/bin/pynagsystemd.py>PyNagSystemD</a></li></ul><h2 id=the-problem>The Problem</h2><p>Postresql will generate errors like this if it encounters any non-UTF8 byte-sequences during a database restore:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># pg_dump -Fc test_badchar | pg_restore -d test_badchar_utf8</span>
</span></span><span style=display:flex><span>pg_restore: <span style=color:#ff79c6>[</span>archiver <span style=color:#ff79c6>(</span>db<span style=color:#ff79c6>)]</span> Error <span style=color:#ff79c6>while</span> PROCESSING TOC:
</span></span><span style=display:flex><span>pg_restore: <span style=color:#ff79c6>[</span>archiver <span style=color:#ff79c6>(</span>db<span style=color:#ff79c6>)]</span> Error from TOC entry 2839; <span style=color:#bd93f9>0</span> <span style=color:#bd93f9>26852</span> TABLE DATA table101 postgres
</span></span><span style=display:flex><span>pg_restore: <span style=color:#ff79c6>[</span>archiver <span style=color:#ff79c6>(</span>db<span style=color:#ff79c6>)]</span> COPY failed <span style=color:#ff79c6>for</span> table <span style=color:#f1fa8c>&#34;table101&#34;</span>: ERROR:  invalid byte sequence <span style=color:#ff79c6>for</span> encoding <span style=color:#f1fa8c>&#34;UTF8&#34;</span>: 0x91
</span></span><span style=display:flex><span>CONTEXT:  COPY table101, line <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>WARNING: errors ignored on restore: <span style=color:#bd93f9>1</span>
</span></span></code></pre></div><p>And the corresponding data will be omitted from the database (in this case, the whole table, even the rows which did not have a problem):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ff79c6>#</span> echo <span style=color:#f1fa8c>&#34;select * from table101;&#34;</span> <span style=color:#ff79c6>|</span> psql test_badchar_utf8
</span></span><span style=display:flex><span> chardecimal <span style=color:#ff79c6>|</span> description <span style=color:#ff79c6>|</span> column6_text
</span></span><span style=display:flex><span><span style=color:#6272a4>-------------+-------------+--------------
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>(<span style=color:#bd93f9>0</span> <span style=color:#ff79c6>rows</span>)
</span></span></code></pre></div><h2 id=the-solution>The Solution</h2><p>To find and replace characters in an SQL_ASCII encoded database which do not conform to the UTF8 encoding requirements.
This should be implemented as an SQL script, so that the data can be updated on a live database, to mininmise the downtime required.</p><p>There is an existing script which will <em>find</em> the offending rows in a table:
<a href=http://sniptools.com/databases/finding-non-utf8-values-in-postgresql>http://sniptools.com/databases/finding-non-utf8-values-in-postgresql</a></p><p>While this will find the offending rows, it cannot do anything about it, as it stands.
A more sophisticated script is required to actually replace the non-UTF8 characters with something acceptable.
Two SQL scripts are provided here, the first of these SQL scripts is:</p><ul><li><a href=https://github.com/sammcj/sql_ascii_to_utf8/blob/master/Replace_non_UTF8.underscore.sql>Replace_non_UTF8.underscore.sql</a></li></ul><p>This will replace all non-UTF8 characters with underscores.
This (at least) will allow the data to be imported successfully to a UTF8 database.
The second of these SQL scripts is:</p><ul><li><a href=https://github.com/sammcj/sql_ascii_to_utf8/blob/master/Replace_non_UTF8.html_equiv.sql>Replace_non_UTF8.html_equiv.sql</a></li></ul><p>will replace selected bytes with a UTF8-sequence which corresponds to what is rendered by Firefox when encoded as <code>&amp;#NN;</code>
where NN is the hexadecimal value of the byte.
Not all values from <code>80-FF</code> are covered by this script. Please add your own translations as required.
Any byte without a specific translation will be replaced with an underscore.</p><h2 id=the-triggers-problem>The Triggers Problem</h2><p>The functions <code>process_non_utf8_at_column()</code> and <code>process_non_utf8_at_schema()</code> work just fine, BUT if there are any &rsquo;triggers&rsquo; on the rows being updated, these triggers are also invoked.
Such triggers may expect a specific set of fields to be updated together, or increment sequence numbers.</p><p>Running these triggers would be an undesirable side-effect of what should be a simple text-update.</p><h2 id=the-locking-problem>The Locking Problem</h2><p>The original solution was designed to minimise downtime, and these scripts would be ineffective if they were to lock table for anything more than a couple of seconds.</p><p>Unfortunately, this is exactly what happens if triggers are diabled per-table while updating the text like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ff79c6>ALTER</span> <span style=color:#ff79c6>TABLE</span> _some_table_ DISABLE <span style=color:#ff79c6>TRIGGER</span> <span style=color:#ff79c6>ALL</span>;
</span></span><span style=display:flex><span>process_non_utf8_at_column(...);
</span></span><span style=display:flex><span><span style=color:#ff79c6>ALTER</span> <span style=color:#ff79c6>TABLE</span> _some_table_ ENABLE <span style=color:#ff79c6>TRIGGER</span> <span style=color:#ff79c6>ALL</span>;
</span></span></code></pre></div><p>Postgres wraps it all in a transaction, and locks the table until the update is complete (which can be minutes on a large table).</p><h2 id=the-non-locking-non-triggering-solution>The Non-Locking, Non-Triggering Solution</h2><p>a) Don&rsquo;t use <code>ALTER TABLE _some_table_ DISABLE TRIGGER ALL;</code>
Instead, use a session-based setting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span>     <span style=color:#ff79c6>SET</span> session_replication_role <span style=color:#ff79c6>=</span> replica;
</span></span></code></pre></div><p>This has the effect of disabling triggers, but does not lock the whole table while the function is running.</p><p>b) Don&rsquo;t try to run the whole DB in one go.</p><p>The following script does a search for offending table,column combinations, and then invokes process_non_utf8_at_column() on each of these individually.</p><ul><li><a href=https://github.com/sammcj/sql_ascii_to_utf8/blob/master/run_process_non_utf8.sh>run_process_non_utf8.sh</a></li></ul><h2 id=sample-db-and-outputs>Sample DB and Outputs</h2><p>A test database can be created using the script:</p><ul><li><a href=https://github.com/sammcj/sql_ascii_to_utf8/blob/master/create_test_sql_ascii.sh>create_test_sql_ascii.sh</a></li></ul><p>This should be run as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span>  <span style=color:#ff79c6>createdb</span> <span style=color:#ff79c6>-</span>e <span style=color:#6272a4>--template=template0 -E SQL_ASCII test_badchar
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  .<span style=color:#ff79c6>/</span>create_test_sql_ascii.sh test_badchar
</span></span></code></pre></div><p>When we run the script, we should see the following output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># psql test_badchar &lt; Replace_non_UTF8.html_equiv.sql</span>
</span></span><span style=display:flex><span>CREATE FUNCTION
</span></span><span style=display:flex><span>CREATE FUNCTION
</span></span><span style=display:flex><span>CREATE FUNCTION
</span></span><span style=display:flex><span>CREATE FUNCTION
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># ./run_process_non_utf8.sh test_badchar</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span><span style=display:flex><span>Start: Tue Apr <span style=color:#bd93f9>19</span> 09:16:30 AEST <span style=color:#8be9fd;font-style:italic>2016</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span><span style=display:flex><span>INFO:  schema: public   table: table101   column: description   time: 2016-04-19 09:16:30.949714+10
</span></span><span style=display:flex><span>INFO:  schema: public   table: table101   column: non_utf8_text   time: 2016-04-19 09:16:30.991793+10
</span></span><span style=display:flex><span>INFO:  schema: public   table: empty_table    column: somedata    time: 2016-04-19 09:16:31.406256+10
</span></span><span style=display:flex><span>    search_for_non_utf8_columns
</span></span><span style=display:flex><span>------------------------------------
</span></span><span style=display:flex><span> <span style=color:#ff79c6>(</span>public,table101,description,1<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span> <span style=color:#ff79c6>(</span>public,table101,non_utf8_text,11<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>2</span> rows<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#39;table101&#39;</span>,<span style=color:#f1fa8c>&#39;description&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#39;table101&#39;</span>,<span style=color:#f1fa8c>&#39;non_utf8_text&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span><span style=display:flex><span>Initial search completed: Tue Apr <span style=color:#bd93f9>19</span> 09:16:31 AEST <span style=color:#bd93f9>2016</span>
</span></span><span style=display:flex><span>Search run <span style=color:#8be9fd;font-style:italic>time</span> <span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>seconds</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span><span style=display:flex><span>processing: <span style=color:#f1fa8c>&#39;table101&#39;</span>,<span style=color:#f1fa8c>&#39;description&#39;</span>
</span></span><span style=display:flex><span>SET <span style=color:#8be9fd;font-style:italic>session_replication_role</span> <span style=color:#ff79c6>=</span> replica;
</span></span><span style=display:flex><span>SET
</span></span><span style=display:flex><span>SELECT process_non_utf8_at_column<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;table101&#39;</span>,<span style=color:#f1fa8c>&#39;description&#39;</span><span style=color:#ff79c6>)</span>;
</span></span><span style=display:flex><span>NOTICE:  table <span style=color:#f1fa8c>&#34;x_list&#34;</span> does not exist, skipping
</span></span><span style=display:flex><span>NOTICE:  1: table: table101    <span style=color:#ff79c6>(</span>column: description<span style=color:#ff79c6>)</span> time: 2016-04-19 09:16:31.425359+10
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>UTF8 follo...��� &lt;-here<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>NOTICE:  1: table: table101    <span style=color:#ff79c6>(</span>column: description<span style=color:#ff79c6>)</span> time: 2016-04-19 09:16:31.481739+10
</span></span><span style=display:flex><span> process_non_utf8_at_column
</span></span><span style=display:flex><span>----------------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>1</span> row<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SET <span style=color:#8be9fd;font-style:italic>session_replication_role</span> <span style=color:#ff79c6>=</span> DEFAULT;
</span></span><span style=display:flex><span>SET
</span></span><span style=display:flex><span>processing: <span style=color:#f1fa8c>&#39;table101&#39;</span>,<span style=color:#f1fa8c>&#39;non_utf8_text&#39;</span>
</span></span><span style=display:flex><span>SET <span style=color:#8be9fd;font-style:italic>session_replication_role</span> <span style=color:#ff79c6>=</span> replica;
</span></span><span style=display:flex><span>SET
</span></span><span style=display:flex><span>SELECT process_non_utf8_at_column<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;table101&#39;</span>,<span style=color:#f1fa8c>&#39;non_utf8_text&#39;</span><span style=color:#ff79c6>)</span>;
</span></span><span style=display:flex><span>NOTICE:  table <span style=color:#f1fa8c>&#34;x_list&#34;</span> does not exist, skipping
</span></span><span style=display:flex><span>NOTICE:  1: table: table101    <span style=color:#ff79c6>(</span>column: non_utf8_text<span style=color:#ff79c6>)</span> time: 2016-04-19 09:16:31.498909+10
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>91-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>92-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>96-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>A3-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>C7-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>D0-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>D5-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>E9-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>FA-&gt; � ���...&lt;- -½�½-<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>�...�<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>INFO:  running remove_non_utf8 <span style=color:#ff79c6>(</span>�🐱�...�🐱�<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>NOTICE:  1: table: table101    <span style=color:#ff79c6>(</span>column: non_utf8_text<span style=color:#ff79c6>)</span> time: 2016-04-19 09:16:32.358957+10
</span></span><span style=display:flex><span> process_non_utf8_at_column
</span></span><span style=display:flex><span>----------------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>1</span> row<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SET <span style=color:#8be9fd;font-style:italic>session_replication_role</span> <span style=color:#ff79c6>=</span> DEFAULT;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>SET</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span><span style=display:flex><span>Update complete: Tue Apr <span style=color:#bd93f9>19</span> 09:16:32 AEST <span style=color:#bd93f9>2016</span>
</span></span><span style=display:flex><span>Update run <span style=color:#8be9fd;font-style:italic>time</span> <span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>seconds</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>=========</span> checking <span style=color:#8be9fd;font-style:italic>results</span> <span style=color:#ff79c6>=============</span>
</span></span><span style=display:flex><span> search_for_non_utf8_columns
</span></span><span style=display:flex><span>-----------------------------
</span></span><span style=display:flex><span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>0</span> rows<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span><span style=display:flex><span>Finish: Tue Apr <span style=color:#bd93f9>19</span> 09:16:32 AEST <span style=color:#bd93f9>2016</span>
</span></span><span style=display:flex><span>Total run <span style=color:#8be9fd;font-style:italic>time</span> <span style=color:#bd93f9>2</span> <span style=color:#8be9fd;font-style:italic>seconds</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>========================================</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ff79c6>#</span> psql test_badchar <span style=color:#ff79c6>&lt;</span> Replace_non_UTF8.cleanup.<span style=color:#ff79c6>sql</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>FUNCTION</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>FUNCTION</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>FUNCTION</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>FUNCTION</span>
</span></span></code></pre></div></div></article><hr><p class=articleTagsContainer><span></span>
<strong>Tags:</strong>
<a class=buttonTag href=../../../tags/data>#data</a>
<a class=buttonTag href=../../../tags/software>#software</a>
<a class=buttonTag href=../../../tags/tech>#tech</a></p><div class=relatedArticlesContainer><hr><h2>More posts like this</h2><div class=postlist><article class="card postlistitem"><div><h2><a href=https://beta.smcleod.net/2022/10/making-work-visible-avoid-dms/>Making Work Visible - Avoid DMs</a></h2><p class=date><span title=Date></span>
2022-10-20
|
<span title=Tags></span>
<a href=../../../tags/communication>#communication</a>
<a href=../../../tags/culture>#culture</a>
<a href=../../../tags/tech>#tech</a>
<a href=../../../tags/work>#work</a></p><a class=unstyledLink href=https://beta.smcleod.net/2022/10/making-work-visible-avoid-dms/><img src=https://beta.smcleod.net/2022/10/making-work-visible-avoid-dms//dm-disruption.jpg alt></a><div class=articlePreview><p><h3 id=avoid-sending-dmspms-for-support-and-technical-questions>Avoid sending DMs/PMs for support and technical questions</h3><p>This is a blurb I usually add to the wiki pages of teams I work with, it&rsquo;s a simple reminder that we should avoid sending direct messages (or worse - calling) individuals for support and technical questions.</p><p>Instead, we should use the appropriate channels for the team. This is a simple way to make work visible, share knowledge, reduce context switching, avoid silos and share the support load.</p></p><p><a href=https://beta.smcleod.net/2022/10/making-work-visible-avoid-dms/>Continue reading </a></p></div></div><hr></article><article class="card postlistitem"><div><h2><a href=https://beta.smcleod.net/2022/10/the-best-of-2022-edition/>The Best Of - 2022 Edition</a></h2><p class=date><span title=Date></span>
2022-10-19
|
<span title=Tags></span>
<a href=../../../tags/bestof>#bestof</a>
<a href=../../../tags/software>#software</a></p><a class=unstyledLink href=https://beta.smcleod.net/2022/10/the-best-of-2022-edition/><img src=https://beta.smcleod.net/2022/10/the-best-of-2022-edition//tools.jpg alt></a><div class=articlePreview><p><p>Near the end of each year I note down a summary of the best apps I&rsquo;ve enjoyed using throughout the year, here&rsquo;s 2022.</p><p><em>See also <a href=https://smcleod.net/software/2022/05/16/firefox-addons-2022/>Firefox Addons - 2022</a></em></p><h2 id=the-best>The Best</h2><ul><li>MeetingBar (Meetings in your menubar) - <a href=https://github.com/leits/MeetingBar>Get MeetingBar</a></li><li>Reeder (RSS) - <a href=https://www.reederapp.com/>Get Reeder</a></li><li>Shottr (Better screenshots) - <a href=https://shottr.cc/>Get Shottr</a></li><li>Bumpr (Multi-browser rules for links) - <a href=https://www.getbumpr.com/>Get Bumper</a></li><li>Onyx (macOS customisation) - <a href=https://titanium-software.fr/en/onyx.html>Get OnyX</a></li><li>Brew (Package manager) - <a href=https://brew.sh/>Get Brew</a><ul><li>mas (Mac App Store manager for Brew) - <a href=https://github.com/mas-cli/mas>Get mas</a></li></ul></li><li>Little Snitch (Firewall) - <a href=https://obdev.at/products/littlesnitch>Get Little Snitch</a><ul><li>RadioSilence (Simple Firewall) - <a href=https://radiosilenceapp.com/>Get RadioSilence</a></li></ul></li><li>Pixelmator Pro (Image/Photo editor) - <a href=https://www.pixelmator.com/pro/>Get Pixelmator Pro</a></li><li>Keka (Archive/Compression tool) - <a href=https://www.keka.io/>Get Keka</a></li><li>LaunchControl (Frontend for launchd) - <a href=https://www.soma-zone.com/LaunchControl/>Get LaunchControl</a></li><li>Peek (Quicklook plugins) - <a href="https://apps.apple.com/au/app/peek-a-quick-look-extension/id1554235898?mt=12">Get Peek</a></li><li>MusicHarbor (Track new and upcoming music releases) - <a href=https://apps.apple.com/au/app/musicharbor-track-new-music/id1440405750>Get MusicHarbor</a></li><li>DaisyDisk (Disk usage inspector) - <a href=https://daisydiskapp.com/>Get DaisyDisk</a></li><li>Things (GTD/Notes/Lists app) - <a href=https://culturedcode.com/things/>Get Thing</a></li><li>BetterTouchTool (macOS automation and customisation) - <a href=https://folivora.ai/>Get BetterTouchTool</a></li><li>Parcel (Track parcels) - <a href=https://apps.apple.com/au/app/parcel/id375589283>Get Parcel</a></li><li>Backblaze (Backups) - <a href=https://www.backblaze.com/>Get Backblaze</a></li><li>MicroSnitch (Get notifications for active mic/webcam) - <a href=https://obdev.at/products/microsnitch/index.html>Get Micro Snitch</a></li><li>Handbrake (Transcode video files) - <a href=https://handbrake.fr/>Get Handbrake</a></li><li>Amphetamine (Keep you mac awake) - <a href="https://apps.apple.com/us/app/amphetamine/id937984704?mt=12">Get Amphetamine</a></li><li>Bear (Markdown/notes/web clipping) - <a href=https://bear.app/>Get Bear</a></li><li>Calibre (eBook management and conversation) - <a href=https://calibre-ebook.com/>Get Calibre</a></li><li>ImageOptim Beta (Image compression) - <a href=https://imageoptim.com/ImageOptim1.8.9a1.tar.bz2>Get ImageOptim</a><ul><li><em>Note: This is a beta version, but it&rsquo;s the only version that supports Apple Silicon natively, the author is working on <a href=https://github.com/ImageOptim/ImageOptim/issues/354>ImageOptim 2 - A complete rewrite</a></em>.</li></ul></li><li>Strongbox (Native password/secrets management) - <a href=https://strongboxsafe.com/>Get StrongBox</a><ul><li><em>Note: I will likely eventually replace 1Password with Strongbox, it&rsquo;s a native app (not Electron!), currently waiting on official browser extensions</em>.</li></ul></li><li>Stay (Window management) - <a href=https://cordlessdog.com/stay/>Get Stay</a></li><li>Firefox (Don&rsquo;t run a browser from an ad company) - <a href=https://www.mozilla.org/en-GB/firefox/new/>Get Firefox</a></li><li>Fastmail (Email) - <a href=https://www.fastmail.com>Get Fastmail</a></li><li>mu-repo (Run bulk commands across git repos) - <a href=https://fabioz.github.io/mu-repo/>Get mu-repo</a></li></ul><p>You can find all the applications I use, along with my shell config and plugins within the <a href=https://github.com/sammcj/zsh-bootstrap>BrewFile</a> which I use to bootstrap my macOS machines.</p><h2 id=the-worst>The Worst</h2><ul><li>💩 AWS CDK 💩</li><li>💩 1Password 8 💩</li><li>💩 Microsoft Teams 💩</li><li>💩 Microsoft Office365 💩</li></ul></p><p><a href=https://beta.smcleod.net/2022/10/the-best-of-2022-edition/>Continue reading </a></p></div></div><hr></article></div></div></main><footer><hr><div class=footerColumns><ul class=notlist><li><strong>Links</strong></li><li><a target=_blank href=https://github.com/sammcj>Github | @sammcj</a></li><li><a target=_blank href=https://twitter.com/s_mcleod>Twitter | @s_mcleod</a></li><li><a target=_blank href=https://smcleod.net>This Website | smcleod.net</a></li></ul></div><p><small>2022 &copy; Sam McLeod</small></p><p><small></small></p></footer></div></div></div></body></html>