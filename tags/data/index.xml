<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>data on smcleod.net</title><link>https://smcleod.net/tags/data/</link><description>Recent content in data on smcleod.net</description><generator>Hugo -- gohugo.io</generator><language>en-au</language><copyright>Sam McLeod</copyright><lastBuildDate>Mon, 23 May 2016 00:00:00 +0000</lastBuildDate><atom:link href="https://smcleod.net/tags/data/index.xml" rel="self" type="application/rss+xml"/><item><title>Online Conversion from SQL_ASCII to UTF8 in PostgreSQL</title><link>https://smcleod.net/2016/05/online-conversion-from-sql_ascii-to-utf8-in-postgresql/</link><pubDate>Mon, 23 May 2016 00:00:00 +0000</pubDate><guid>https://smcleod.net/2016/05/online-conversion-from-sql_ascii-to-utf8-in-postgresql/</guid><description>&lt;p>Scripts and source available here: &lt;a href="https://github.com/sammcj/sql_ascii_to_utf8">sql_ascii_to_utf8&lt;/a>&lt;/p>
&lt;h2 id="the-goal">The Goal&lt;/h2>
&lt;p>To be able to take a Postgres Database which is in SQL_ASCII encoding, and import it into a UTF8 encoded database.&lt;/p>
&lt;p>Requirements:&lt;/p>
&lt;ul>
&lt;li>Python3 (For RHEL/CentOS 7 &lt;code>yum install python34&lt;/code>)&lt;/li>
&lt;li>python-nagiosplugin &lt;a href="https://packagecloud.io/app/s_mcleod/centos7/search?q=python-nagiosplugin">My pre-built RPMs&lt;/a> or &lt;code>pip3 install nagiosplugin&lt;/code>&lt;/li>
&lt;li>&lt;a href="https://github.com/kbytesys/pynagsystemd/blob/master/bin/pynagsystemd.py">PyNagSystemD&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="the-problem">The Problem&lt;/h2>
&lt;p>Postresql will generate errors like this if it encounters any non-UTF8 byte-sequences during a database restore:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># pg_dump -Fc test_badchar | pg_restore -d test_badchar_utf8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pg_restore: &lt;span style="color:#ff79c6">[&lt;/span>archiver &lt;span style="color:#ff79c6">(&lt;/span>db&lt;span style="color:#ff79c6">)]&lt;/span> Error &lt;span style="color:#ff79c6">while&lt;/span> PROCESSING TOC:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pg_restore: &lt;span style="color:#ff79c6">[&lt;/span>archiver &lt;span style="color:#ff79c6">(&lt;/span>db&lt;span style="color:#ff79c6">)]&lt;/span> Error from TOC entry 2839; &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#bd93f9">26852&lt;/span> TABLE DATA table101 postgres
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pg_restore: &lt;span style="color:#ff79c6">[&lt;/span>archiver &lt;span style="color:#ff79c6">(&lt;/span>db&lt;span style="color:#ff79c6">)]&lt;/span> COPY failed &lt;span style="color:#ff79c6">for&lt;/span> table &lt;span style="color:#f1fa8c">&amp;#34;table101&amp;#34;&lt;/span>: ERROR: invalid byte sequence &lt;span style="color:#ff79c6">for&lt;/span> encoding &lt;span style="color:#f1fa8c">&amp;#34;UTF8&amp;#34;&lt;/span>: 0x91
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CONTEXT: COPY table101, line &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARNING: errors ignored on restore: &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>